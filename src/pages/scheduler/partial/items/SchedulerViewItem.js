/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2024 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const re=require("react"),ie=require("./SchedulerItem.js"),b=require("../utils/index.js"),S=require("../views/common/utils.js"),h=require("../constants/index.js"),ce=require("@progress/kendo-react-intl"),N=require("./SchedulerItemContent.js"),E=require("@progress/kendo-react-common"),v=require("@progress/kendo-svg-icons"),le=require("../hooks/useRowSync.js"),se=require("../hooks/useEditable.js"),B=require("../context/SchedulerViewContext.js"),oe=require("../context/SchedulerContext.js");function ae(e){const g=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const m in e)if(m!=="default"){const R=Object.getOwnPropertyDescriptor(e,m);Object.defineProperty(g,m,R.get?R:{enumerable:!0,get:()=>e[m]})}}return g.default=e,Object.freeze(g)}const n=ae(re),ue=1,j=n.forwardRef((e,g)=>{const{item:m,_ref:R,itemRef:$,...L}=e,y=n.useRef(),c=n.useRef(null),A=n.useRef(null),P=n.useRef(null),G=se.useEditable(e.editable);n.useImperativeHandle(A,()=>({props:e,element:c.current&&c.current.element})),n.useImperativeHandle(g,()=>A.current),n.useImperativeHandle(R,()=>c.current),n.useImperativeHandle($,()=>c.current);const K=m||F.item,D=ce.useInternationalization(),[J]=B.useSchedulerViewItemsContext(),[q]=B.useSchedulerViewSlotsContext(),I=oe.useSchedulerElementContext(),[Q,H]=n.useState(!0),[U,X]=n.useState(!1),[Y,Z]=n.useState(0),T=E.useDir(I),k=n.useMemo(()=>e.isAllDay?D.toString(e.zonedStart,"t"):D.format("{0:t} - {1:t}",e.zonedStart,e.zonedEnd),[D,e.isAllDay,e.zonedEnd,e.zonedStart]),C=n.useMemo(()=>`(${k}): ${e.title}`,[k,e.title]),V=(r,t)=>{let l=1;return r.forEach(o=>{const u=t.filter(d=>w(o.current.props,d.props));u.length>l&&(l=u.length)}),l},p=(r,t)=>r.map(o=>t.filter(u=>w(o.current.props,u.props))),w=(r,t)=>b.intersects(r.start,r.end,t.start,t.end)&&r.group.index===t.group.index&&r.range.index===t.range.index&&(e.ignoreIsAllDay||r.isAllDay===t.isAllDay),x=()=>{const r=(q||[]).filter(o=>o.current&&w(o.current.props,e));if(r.length===0){H(!1);return}const t=b.first(r);if(!t.current||!c.current)return;const l=S.getRect(t.current.element);S.setRect(c.current.element,l)},z=()=>{const r=c.current&&c.current.element;if(!r)return;const t=(q||[]).filter(s=>s.current&&w(s.current.props,e)),l=[],o=[],u=[];(J||[]).forEach(s=>{s.current&&(s.current.props.dragHint?o.push(s.current):s.current.props.resizeHint?u.push(s.current):l.push(s.current))});const d=e.dragHint||e.resizeHint?b.calculateOrder(c.current,e.dragHint?o:u,t,e.ignoreIsAllDay):e.order||0;let f=e.dragHint||e.resizeHint?V(t,e.dragHint?o:u):V(t,l);const te=p(t,l);let O=0;const i=S.getRect(r);if(te.forEach(s=>{let _=0;s.forEach(a=>{b.intersects(a.props.start,a.props.end,e.start,e.end)&&!(e.dragHint||e.resizeHint)&&a.props._maxSiblingsPerSlot&&a.props._maxSiblingsPerSlot>f&&a.element!==r&&(f=a.props._maxSiblingsPerSlot);const M=S.getRect(a.element);a.props.order!==null&&a.props.order<d&&(_=M.top+M.height-i.top-h.BORDER_WIDTH*d+ue)}),_>O&&(O=_)}),t.length===0){H(!1);return}const ne=G.add?20:0;i.width=e.vertical?i.width/f-h.BORDER_WIDTH-ne/f:i.width*t.length-h.BORDER_WIDTH,i.height=e.vertical?i.height*t.length-h.BORDER_WIDTH:(e.resizeHint||e.dragHint)&&f<=1?i.height:e.style&&e.style.height?e.style.height:25,i.left=e.vertical?i.left+d*i.width+h.BORDER_WIDTH*d:i.left,i.top=e.vertical?i.top:i.top+O+h.BORDER_WIDTH*d,Z(f),S.setRect(r,i),X(!0),H(!0)},W=n.useCallback(r=>{const t=r&&r[0],l=P.current;y.current!==void 0&&window.cancelAnimationFrame(y.current),l&&t&&(l.width!==t.contentRect.width||l.height!==t.contentRect.height)&&(y.current=window.requestAnimationFrame(()=>{x(),z()})),P.current={width:t.contentRect.width,height:t.contentRect.height}},[x,z]);n.useEffect(x),n.useEffect(z);const ee=c.current&&c.current.element?c.current.element.closest(".k-scheduler-layout"):null;return le.useRowSync({element:ee,selector:".k-resource-row",horizontalAttribute:"data-depth-index",verticalAttribute:"data-resource-index",applyTo:".k-resource-cell",syncHeight:e.isLast}),n.useEffect(()=>{if(!I.current)return;const r=window.ResizeObserver,t=r&&new r(W);return t&&t.observe(I.current),()=>{t&&t.disconnect()}},[W,I]),n.createElement(K,{...L,_ref:c,_maxSiblingsPerSlot:Y,itemRef:c,style:{visibility:U?void 0:"hidden",display:Q?void 0:"none",...e.style}},!e.resizeHint&&n.createElement("span",{className:"k-event-actions"},e.tail&&n.createElement(E.IconWrap,{name:T==="rtl"?"caret-alt-right":"caret-alt-left",icon:T==="rtl"?v.caretAltRightIcon:v.caretAltLeftIcon}),e.isRecurring&&!e.isException&&n.createElement(E.IconWrap,{name:"arrow-rotate-cw",icon:v.arrowRotateCwIcon}),!e.isRecurring&&e.isException&&n.createElement(E.IconWrap,{name:"arrows-no-repeat",icon:v.arrowsNoRepeatIcon})),!e.resizeHint&&n.createElement("div",{title:C},!e.isAllDay&&n.createElement(N.SchedulerItemContent,{className:"k-event-template k-event-time "},C),n.createElement(N.SchedulerItemContent,{className:"k-event-template"},e.title)))}),F={item:ie.SchedulerItem};j.displayName="KendoReactSchedulerViewItem";exports.SchedulerViewItem=j;exports.schedulerViewItemDefaultProps=F;
