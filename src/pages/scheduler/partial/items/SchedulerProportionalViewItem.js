/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2024 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const le=require("react"),oe=require("./SchedulerItem.js"),f=require("../utils/index.js"),g=require("../views/common/utils.js"),h=require("../constants/index.js"),ae=require("@progress/kendo-react-intl"),K=require("./SchedulerItemContent.js"),D=require("@progress/kendo-react-common"),H=require("@progress/kendo-svg-icons"),L=require("../context/SchedulerViewContext.js"),ue=require("../context/SchedulerContext.js");function me(e){const S=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const m in e)if(m!=="default"){const w=Object.getOwnPropertyDescriptor(e,m);Object.defineProperty(S,m,w.get?w:{enumerable:!0,get:()=>e[m]})}}return S.default=e,Object.freeze(S)}const r=me(le),de=1,J=r.forwardRef((e,S)=>{const{item:m,_ref:w,itemRef:U,...X}=e,y=r.useRef(),s=r.useRef(null),q=r.useRef(null),C=r.useRef(null);r.useImperativeHandle(q,()=>({props:e,element:s.current&&s.current.element})),r.useImperativeHandle(S,()=>q.current),r.useImperativeHandle(w,()=>s.current),r.useImperativeHandle(U,()=>s.current);const Y=m||Q.item,x=ae.useInternationalization(),[Z]=L.useSchedulerViewItemsContext(),[M]=L.useSchedulerViewSlotsContext(),v=ue.useSchedulerElementContext(),[p,P]=r.useState(!0),[ee,te]=r.useState(!1),[ne,re]=r.useState(0),k=D.useDir(v),V=r.useMemo(()=>e.isAllDay?x.toString(e.zonedStart,"t"):x.format("{0:t} - {1:t}",e.zonedStart,e.zonedEnd),[x,e.isAllDay,e.zonedEnd,e.zonedStart]),W=r.useMemo(()=>`(${V}): ${e.title}`,[V,e.title]),B=(n,t)=>{let i=1;return n.forEach(o=>{const u=t.filter(R=>b(o.current.props,R.props));u.length>i&&(i=u.length)}),i},ie=(n,t)=>n.map(o=>t.filter(u=>b(o.current.props,u.props))),b=(n,t)=>f.intersects(n.start,n.end,t.start,t.end)&&n.group.index===t.group.index&&n.range.index===t.range.index&&(e.ignoreIsAllDay||n.isAllDay===t.isAllDay),T=()=>{const n=(M||[]).filter(o=>o.current&&b(o.current.props,e));if(n.length===0){P(!1);return}const t=f.first(n);if(!t.current||!s.current)return;const i=g.getRect(t.current.element);g.setRect(s.current.element,i)},z=()=>{const n=(M||[]).filter(l=>l.current&&b(l.current.props,e)),t=s.current&&s.current.element;if(!t||!n.length)return;const i=f.first(n),o=f.last(n);if(!i.current||!s.current||!o.current)return;const u=[],R=[],O=[],j=g.getRect(i.current.element),F=(e.vertical?j.height:j.width)/(i.current.props.end.getTime()-i.current.props.start.getTime()),E=(e.start.getTime()-i.current.props.start.getTime())*F,$=(Math.min(e.end.getTime(),o.current.props.end.getTime())-Math.max(e.start.getTime(),i.current.props.start.getTime()))*F;(Z||[]).forEach(l=>{l.current&&(l.current.props.dragHint?R.push(l.current):l.current.props.resizeHint?O.push(l.current):u.push(l.current))});const I=e.dragHint||e.resizeHint?f.calculateOrder(s.current,e.dragHint?R:O,n,e.ignoreIsAllDay):e.order||0;let d=e.dragHint||e.resizeHint?B(n,e.dragHint?R:O):B(n,u);const ce=ie(n,u);let _=0;const c=g.getRect(t);if(ce.forEach(l=>{let A=0;l.forEach(a=>{f.intersects(a.props.start,a.props.end,e.start,e.end)&&!(e.dragHint||e.resizeHint)&&a.props._maxSiblingsPerSlot&&a.props._maxSiblingsPerSlot>d&&a.element!==t&&(d=a.props._maxSiblingsPerSlot);const G=g.getRect(a.element);a.props.order!==null&&a.props.order<I&&(A=G.top+G.height-c.top-h.BORDER_WIDTH*I+de)}),A>_&&(_=A)}),n.length===0){P(!1);return}const se=20;c.width=e.vertical?c.width/d-h.BORDER_WIDTH-se/d:$+h.BORDER_WIDTH,c.height=e.vertical?$-h.BORDER_WIDTH:(e.resizeHint||e.dragHint)&&d<=1?c.height:e.style&&e.style.height?e.style.height:25,c.left=e.vertical?c.left+I*c.width+h.BORDER_WIDTH*I:c.left+(E<0?0:E),c.top=e.vertical?c.top+(E<0?0:E):c.top+_+h.BORDER_WIDTH*I,re(d),g.setRect(t,c),te(!0),P(!0)},N=r.useCallback(n=>{const t=n&&n[0],i=C.current;y.current!==void 0&&window.cancelAnimationFrame(y.current),i&&t&&(i.width!==t.contentRect.width||i.height!==t.contentRect.height)&&(y.current=window.requestAnimationFrame(()=>{T(),z()})),C.current={width:t.contentRect.width,height:t.contentRect.height}},[T,z]);return r.useEffect(T),r.useEffect(z),r.useEffect(()=>{if(!v.current)return;const n=window.ResizeObserver,t=n&&new n(N);return t&&t.observe(v.current),()=>{t&&t.disconnect()}},[N,v]),r.createElement(Y,{...X,_ref:s,_maxSiblingsPerSlot:ne,itemRef:s,style:{visibility:ee?void 0:"hidden",display:p?void 0:"none",...e.style}},!e.resizeHint&&r.createElement("span",{className:"k-event-actions"},e.tail&&r.createElement(D.IconWrap,{name:k==="rtl"?"caret-alt-right":"caret-alt-left",icon:k==="rtl"?H.caretAltRightIcon:H.caretAltLeftIcon}),e.isRecurring&&!e.isException&&r.createElement(D.IconWrap,{name:"reload",icon:H.arrowRotateCwIcon}),!e.isRecurring&&e.isException&&r.createElement(D.IconWrap,{name:"non-recurrence",icon:H.nonRecurrenceIcon})),!e.resizeHint&&r.createElement("div",{title:W},!e.isAllDay&&r.createElement(K.SchedulerItemContent,{className:"k-event-template k-event-time "},W),r.createElement(K.SchedulerItemContent,{className:"k-event-template"},e.title)))}),Q={item:oe.SchedulerItem};J.displayName="KendoReactSchedulerProportionalViewItem";exports.SchedulerProportionalViewItem=J;exports.schedulerProportionalViewItemDefaultProps=Q;
